#!/bin/bash

# Replace 'your_json_file.json' with the actual path to your JSON file
JSON_FILE="your_json_file.json"

# Function to extract vulnerability information
extract_vulnerabilities() {
  local severity=$(echo "$1" | jq -r '.severity.label')
  local cve_name=$(echo "$1" | jq -r '.name')
  local source_url=$(echo "$1" | jq -r '.sourceUrl')

  echo "Severity: $severity"
  echo "CVE Name: $cve_name"
  echo "Source URL: $source_url"
}

# Main script
if [ -f "$JSON_FILE" ]; then
  # Count total vulnerabilities
  total_vulnerabilities=$(jq -r '.metadata.vulnerabilities.total' "$JSON_FILE")
  echo "Total Vulnerabilities: $total_vulnerabilities"

  # Loop through the list of vulnerabilities and extract information
  vulnerabilities_list=$(jq -c '.metadata.vulnerabilities.list[]' "$JSON_FILE")
  while IFS= read -r vulnerability; do
    extract_vulnerabilities "$vulnerability"
    echo "----------------------------------------"
  done <<< "$vulnerabilities_list"
else
  echo "Error: JSON file not found."
fi



# Print the extracted values
echo "Result: $result"
echo "Scan URL: $scan_url"
echo "Vulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count"

slack_message=$(cat <<EOF
{
  "channel": "$YOUR_CHANNEL_ID",
  "text": "Sysdig Result: \"$result\"\nVulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count\nSysdigURL: \"$scan_url\""
}
EOF
)

