#!/bin/bash

# Replace 'path_to_json_file' with the actual path to your JSON file
json_data=$(cat path_to_json_file)

print_total_by_severity() {
    severity_label=$1
    total=$(echo "$json_data" | jq -r --arg label "$severity_label" '.vulnerabilities.byseverity[] | select(.label == $label) | .total')
    echo "Severity: $severity_label, Total: $total"
}

# Extract and print total value for each severity label
print_total_by_severity "Critical"
print_total_by_severity "High"
print_total_by_severity "Medium"
print_total_by_severity "Low"
print_total_by_severity "Negligible"



# Print the extracted values
echo "Result: $result"
echo "Scan URL: $scan_url"
echo "Vulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count"

slack_message=$(cat <<EOF
{
  "channel": "$YOUR_CHANNEL_ID",
  "text": "Sysdig Result: \"$result\"\nVulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count\nSysdigURL: \"$scan_url\""
}
EOF
)

