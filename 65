pipeline {
    agent {label ''}
    options {
        skipDefaultCheckout true
    }
    stages {
        stage('Checkout external proj') {
            steps {
                git branch: 'master',
                    credentialsId: 'svc.jenkins-idpw',
                    url: 'https://xxxx/DevOps/_git/automation_scripts'
                bat"""
                dir
                """
            }
        }
        stage('Build') {
			steps{
			withVault(configuration: [timeout: 60, vaultCredentialId: 'Vault-Token', vaultUrl: ''], vaultSecrets: [[path: 'secret/tfs', secretValues: [[vaultKey: 'username'], [vaultKey: 'password']]]]) {
			contentReplace(
            configs: [
                fileContentReplaceConfig(
                    configs: [
                        fileContentReplaceItemConfig( 
                            search: 'ABC',
                            replace: '${username}',
                            matchCount: 1)
                        ],
                    fileEncoding: 'UTF-8', 
                    filePath: 'configfile')
                    ])
				}
			}
        }
        stage('Test') {
            steps {
                bat"""
                    dir
                """
            }
        }
        stage('Deploy') {
            steps {
                bat"""
                    dir
                """
            }
        }
    }
}
