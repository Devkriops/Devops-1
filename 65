#!/bin/bash

json_data=$(cat path_to_json_file)

print_total_by_severity() {
    local json_data="$1"
    local total
    local severity_label

    total=$(echo "$json_data" | jq -r '.vulnerabilities.byseverity[] | .total')
    severity_label=$(echo "$json_data" | jq -r '.vulnerabilities.byseverity[] | .label')

    for i in $(seq 0 $(expr $(echo "$severity_label" | wc -w) - 1)); do
        label=$(echo "$severity_label" | awk -v i=$i '{print $i}')
        count=$(echo "$total" | awk -v i=$i '{print $i}')
        echo "Severity: $label, Total: $count"
    done
}

print_total_by_severity "$json_data"




# Print the extracted values
echo "Result: $result"
echo "Scan URL: $scan_url"
echo "Vulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count"

slack_message=$(cat <<EOF
{
  "channel": "$YOUR_CHANNEL_ID",
  "text": "Sysdig Result: \"$result\"\nVulnerabilities: Critical=$critical_count; High=$high_count; Medium=$medium_count; Low=$low_count\nSysdigURL: \"$scan_url\""
}
EOF
)

