
#!/bin/bash

# Generate UUID
UUID=$(wget -qO- url)

# Update job.properties file with UUID
sed -i "s|^project\.passthrough=.*$|project\.passthrough=$UUID|g" job.properties

# Function to check status and extract fields
check_status() {
    local status_output=$(wget -qO- "url")
    local status=$(echo "$status_output" | jq -r '.status')
    local critical=$(echo "$status_output" | jq -r '.critical')
    local high=$(echo "$status_output" | jq -r '.high')
    local medium=$(echo "$status_output" | jq -r '.medium')
    local low=$(echo "$status_output" | jq -r '.low')
    
    echo "Status: $status"
    echo "Critical: $critical"
    echo "High: $high"
    echo "Medium: $medium"
    echo "Low: $low"
}

# Initialize start time
start_time=$(date +%s)

# Check status until it's success or 1 hour has passed
while true; do
    current_time=$(date +%s)
    elapsed_time=$((current_time - start_time))
    if (( elapsed_time >= 3600 )); then
        echo "Scanning is still processing after 1 hour"
        break
    fi
    
    check_status
    
    if [[ "$(check_status | jq -r '.status')" == "success" ]]; then
        break
    fi
    
    sleep 10 # Wait for 10 seconds before checking again
done
